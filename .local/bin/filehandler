#!/bin/sh
#Handle files from stdin or argument. Used to select a file to handle from something like fzf.

ziphandler () {
	DIR="$(echo "$INPUT" | sed "s/.zip//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	unzip "$INPUT"
	rm "$INPUT"
	cd ..
}

tarhandler () {
	DIR="$(echo "$INPUT" | sed "s/.tar//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	tar xpf "$INPUT"
	rm "$INPUT"
	cd ..
}

targzhandler () {
	gzip -d "$INPUT"
	DIR="$(echo "$INPUT" | sed "s/.tar.gz//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	INPUT=""$DIR".tar"
	tarhandler
}

tarxzhandler () {
	gzip -d "$INPUT"
	DIR="$(echo "$INPUT" | sed "s/.tar.xz//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	INPUT=""$DIR".tar"
	tarhandler
}

[ -t 0 ] && TYPE="ARG" || TYPE="STDIN"
[ "$TYPE" = "ARG" ] && INPUT="$1" || INPUT="$(cat)"
INPUT="$(echo "$INPUT" | sed 's/^ //')"
[ -z "$INPUT" ] && echo 'Usage: filehandler [file]' && exit

case "$INPUT" in
	*.bash) bash "$INPUT" ;;
	*.crx) ziphandler "$INPUT" ;;
	*.gif) mpv --loop-file=inf "$INPUT" ;;
	*.jpeg|*.jpg|*.png) sxiv "$INPUT" * ;;
	*.m4v|*.wav|*.mkv|*.mov|*.mp3|*.mp4|*.ogg|*.ogv|*.3gp|*.flac|*.brstm) mpv "$INPUT" ;;
	*.psd|*.xcf) gimp "$INPUT" ;;
	*.tar) tarhandler "$@" ;;
	*.tar.gz) targzhandler "$@" ;;
	*.zip) ziphandler "$@" ;;
	*.rar) unrar e "$INPUT" ;;
	*.cbz|*.cbr) sxcv "$INPUT" ;;
	*) vim --not-a-term "$INPUT" ;;
esac

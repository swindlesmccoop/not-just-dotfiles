#!/bin/sh
#Handle files from stdin or argument. Used to select a file to handle from something like fzf.

ziphandler () {
	DIR="$(echo "$INPUT" | sed "s/.zip//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	unzip "$INPUT"
	rm "$INPUT"
	cd ..
}

[ -t 0 ] && TYPE="ARG" || TYPE="STDIN"
[ "$TYPE" = "ARG" ] && INPUT="$1" || INPUT="$(cat)"
INPUT="$(echo "$INPUT" | sed 's/ //')"
[ -z "$INPUT" ] && echo 'Usage: filehandler (file)' && exit

case "$INPUT" in
	*.png) sxiv "$INPUT" ;;
	*.jpg) sxiv "$INPUT" ;;
	*.psd) gimp "$INPUT" ;;
	*.xcf) gimp "$INPUT" ;;
	*.mp4) mpv "$INPUT" ;;
	*.ogv) mpv "$INPUT" ;;
	*.m4v) mpv "$INPUT" ;;
	*.mkv) mpv "$INPUT" ;;
	*.mov) mpv "$INPUT" ;;
	*.gif) mpv --loop-file=inf "$INPUT" ;;
	*.sh) sh "$INPUT" ;;
	*.bash) bash "$INPUT" ;;
	*.zip) ziphandler "$@" ;;
	*) vim --not-a-term "$INPUT" ;;
esac

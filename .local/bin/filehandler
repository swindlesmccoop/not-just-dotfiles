#!/bin/sh
#Handle files from stdin or argument. Used to select a file to handle from something like fzf.

ziphandler () {
	DIR="$(echo "$INPUT" | sed "s/.zip//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	unzip "$INPUT"
	rm "$INPUT"
	cd ..
}

tarhandler () {
	DIR="$(echo "$INPUT" | sed "s/.tar//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	tar xpf "$INPUT"
	rm "$INPUT"
	cd ..
}

targzhandler () {
	gzip -d "$INPUT"
	DIR="$(echo "$INPUT" | sed "s/.tar.gz//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	INPUT=""$DIR".tar"
	tarhandler
}

tarxzhandler () {
	gzip -d "$INPUT"
	DIR="$(echo "$INPUT" | sed "s/.tar.xz//")"
	mkdir "$DIR"
	mv "$INPUT" "$DIR"
	cd "$DIR"
	INPUT=""$DIR".tar"
	tarhandler
}

[ -t 0 ] && TYPE="ARG" || TYPE="STDIN"
[ "$TYPE" = "ARG" ] && INPUT="$1" || INPUT="$(cat)"
INPUT="$(echo "$INPUT" | sed 's/ //')"
[ -z "$INPUT" ] && echo 'Usage: filehandler (file)' && exit

case "$INPUT" in
	*.png) sxiv "$INPUT" ;;
	*.jpg) sxiv "$INPUT" ;;
	*.psd) gimp "$INPUT" ;;
	*.xcf) gimp "$INPUT" ;;
	*.mp4) mpv "$INPUT" ;;
	*.ogv) mpv "$INPUT" ;;
	*.m4v) mpv "$INPUT" ;;
	*.mkv) mpv "$INPUT" ;;
	*.mov) mpv "$INPUT" ;;
	*.gif) mpv --loop-file=inf "$INPUT" ;;
	*.bash) bash "$INPUT" ;;
	*.zip) ziphandler "$@" ;;
	*.tar) tarhandler "$@" ;;
	*.tar.gz) targzhandler "$@" ;;
	*.tar.xz) tarxzhandler "$@" ;;
	*.brstm) mpv "$INPUT" ;;
	*.ogg) mpv "$INPUT" ;;
	*.mp3) mpv "$INPUT" ;;
	*.flac) mpv "$INPUT" ;;
	*.wav) mpv "$INPUT" ;;
	*) vim --not-a-term "$INPUT" ;;
esac
